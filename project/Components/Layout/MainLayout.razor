@inherits LayoutComponentBase
@inject NavigationManager NavigationManager

<div class="dashboard-container @(isSidebarOpen ? "sidebar-open" : "sidebar-closed")">
    <!-- Top bar only visible on small screens -->
    <div class="topbar">
        <button class="menu-button" @onclick="ToggleSidebar" aria-label="Open navigation">☰</button>
    </div>

    @if (!hideSidebar)
    {
        <!-- Sidebar (responsive) -->
        <div class="sidebar">
            <div class="sidebar-header">
                <img src="/powerhouse_logo.png" class="sidebar-logo" alt="PowerHouse Logo" />
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li>
                        <NavLink href="/dashboard" class="nav-link" activeClass="active">
                            <img src="/dashboard_icon.svg" class="sidebar-icon" alt="Dashboard" />
                            Dashboard
                        </NavLink>
                    </li>
                    <li>
                        <NavLink href="/members" class="nav-link" activeClass="active">
                            <img src="/members_icon.svg" class="sidebar-icon" alt="Members" />
                            Members
                        </NavLink>
                    </li>
                    <li>
                        <NavLink href="/trainers" class="nav-link" activeClass="active">
                            <img src="/trainer_icon.svg" class="sidebar-icon" alt="Trainers" />
                            Trainers
                        </NavLink>
                    </li>
                    <li>
                        <NavLink href="/attendance" class="nav-link" activeClass="active">
                            <img src="/attendance_icon.svg" class="sidebar-icon" alt="Attendance" />
                            Attendance
                        </NavLink>
                    </li>
                    <li>
                        <NavLink href="/payment" class="nav-link" activeClass="active">
                            <img src="/payment_icon.svg" class="sidebar-icon" alt="Payment" />
                            Payment
                        </NavLink>
                    </li>
                    <li>
                        <NavLink href="/promotions" class="nav-link" activeClass="active">
                            <img src="/promotions_icon.svg" class="sidebar-icon" alt="Promotions" />
                            Promotions
                        </NavLink>
                    </li>
                    <li>
                        <NavLink href="/reports" class="nav-link" activeClass="active">
                            <img src="/report_icon.svg" class="sidebar-icon" alt="Reports" />
                            Reports
                        </NavLink>
                    </li>
                    <li>
                        <NavLink href="/settings" class="nav-link" activeClass="active">
                            <img src="/settings_icon.svg" class="sidebar-icon" alt="Settings" />
                            Settings
                        </NavLink>
                    </li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                <div class="sidebar-logout" @onclick="Logout">
                    <img src="/logout_icon.svg" class="sidebar-icon" alt="Logout" />
                    Logout
                </div>
            </div>
        </div>

        <!-- Clickable overlay to close sidebar on mobile -->
        <div class="backdrop @(isSidebarOpen ? "show" : "")" @onclick="CloseSidebar"></div>
    }

    <div class="main-content">
        @Body
    </div>
</div>

<style>
    .sidebar-icon {
        filter: brightness(0) invert(1);
    }
</style>

@code {
    private bool isSidebarOpen = true;
    private bool hideSidebar = false;

    private void Logout()
    {
        NavigationManager.NavigateTo("/login");
    }

    private void ToggleSidebar() => isSidebarOpen = !isSidebarOpen;
    private void CloseSidebar() => isSidebarOpen = false;

    protected override void OnParametersSet()
    {
        var uri = NavigationManager.Uri.ToLower();
        // Hide sidebar only on login or register page
        hideSidebar = uri.Contains("/login") || uri.Contains("/register");
    }
}