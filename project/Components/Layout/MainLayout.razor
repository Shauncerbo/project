@inherits LayoutComponentBase
@inject NavigationManager NavigationManager

<div class="dashboard-container @(isSidebarOpen ? "sidebar-open" : "sidebar-closed")">
    <!-- Top bar only visible on small screens -->
    <div class="topbar">
        <button class="menu-button" @onclick="ToggleSidebar" aria-label="Open navigation">☰</button>
    </div>

    @if (!hideSidebar)
    {
        <!-- Sidebar (responsive) -->
        <div class="sidebar">
            <div class="sidebar-header">
                <img src="/powerhouse_logo.png" class="sidebar-logo" alt="PowerHouse Logo" />
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li>
                        <!-- FIX: Added exact matching to prevent multiple active items -->
                        <NavLink href="/dashboard" class="nav-link" activeClass="active" >
                            <img src="/dashboard_icon.svg" class="sidebar-icon" alt="Dashboard" />
                            Dashboard
                        </NavLink>
                    </li>
                    <li>
                        <NavLink href="/members" class="nav-link" activeClass="active">
                            <img src="/members_icon.svg" class="sidebar-icon" alt="Members" />
                            Members
                        </NavLink>
                    </li>
                    <li>
                        <NavLink href="/trainers" class="nav-link" activeClass="active">
                            <img src="/trainer_icon.svg" class="sidebar-icon" alt="Trainers" />
                            Trainers
                        </NavLink>
                    </li>
                    <li>
                        <NavLink href="/walkins" class="nav-link" activeClass="active">
                            <img src="/walkin_icon.svg" class="sidebar-icon" alt="Walk-ins" />
                            Walk-ins
                        </NavLink>
                    </li>
                    <li>
                        <NavLink href="/attendance" class="nav-link" activeClass="active">
                            <img src="/attendance_icon.svg" class="sidebar-icon" alt="Attendance" />
                            Attendance
                        </NavLink>
                    </li>
                    <li>
                        <NavLink href="/payment" class="nav-link" activeClass="active">
                            <img src="/payment_icon.svg" class="sidebar-icon" alt="Payment" />
                            Payment
                        </NavLink>
                    </li>
                    <li>
                        <NavLink href="/promotions" class="nav-link" activeClass="active">
                            <img src="/promotions_icon.svg" class="sidebar-icon" alt="Promotions" />
                            Promotions
                        </NavLink>
                    </li>
                    <li>
                        <NavLink href="/reports" class="nav-link" activeClass="active">
                            <img src="/report_icon.svg" class="sidebar-icon" alt="Reports" />
                            Reports
                        </NavLink>
                    </li>
                    <li>
                        <NavLink href="/settings" class="nav-link" activeClass="active">
                            <img src="/settings_icon.svg" class="sidebar-icon" alt="Settings" />
                            Settings
                        </NavLink>
                    </li>
                    <!-- Move logout here and use the same structure -->
                    <li class="logout-item">
                        <div class="nav-link logout-link" @onclick="Logout">
                            <img src="/logout_icon.svg" class="sidebar-icon" alt="Logout" />
                            Logout
                        </div>
                    </li>
                </ul>
            </nav>
            <!-- Remove the sidebar-footer div -->
        </div>

        <!-- Clickable overlay to close sidebar on mobile -->
        <div class="backdrop @(isSidebarOpen ? "show" : "")" @onclick="CloseSidebar"></div>
    }

    <div class="main-content">
        @Body
    </div>
</div>

<style>
    .sidebar-icon {
        filter: brightness(0) invert(1);
    }

    /* Optional: Add specific styling for logout if needed */
    .logout-item {
        margin-top: auto; /* This will push logout to bottom if using flexbox */
    }

    .logout-link {
        cursor: pointer;
    }

    /* Active State Indicator Styles */
    .sidebar-nav .nav-link.active {
        background: rgba(255, 255, 255, 0.15);
        border-left: 4px solid #5cb85c;
        position: relative;
    }

        .sidebar-nav .nav-link.active::before {
            content: "";
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 3px;
            background: #5cb85c;
            border-radius: 0 2px 2px 0;
        }

        .sidebar-nav .nav-link.active .sidebar-icon {
            filter: brightness(0) invert(1) sepia(1) saturate(5) hue-rotate(85deg);
            transform: scale(1.1);
        }

    .sidebar-nav .nav-link.active {
        font-weight: 600;
        color: white;
    }

    /* Hover effects for all nav links */
    .sidebar-nav .nav-link:not(.active):hover {
        background: rgba(255, 255, 255, 0.08);
        border-left: 4px solid rgba(255, 255, 255, 0.3);
    }

        .sidebar-nav .nav-link:not(.active):hover .sidebar-icon {
            transform: scale(1.05);
            transition: transform 0.2s ease;
        }

    /* Smooth transitions */
    .sidebar-nav .nav-link {
        transition: all 0.3s ease;
        border-left: 4px solid transparent;
    }

        .sidebar-nav .nav-link .sidebar-icon {
            transition: all 0.3s ease;
        }

    /* Logout specific styling */
    .logout-item .nav-link:hover {
        background: rgba(220, 53, 69, 0.1);
        border-left: 4px solid rgba(220, 53, 69, 0.5);
    }

        .logout-item .nav-link:hover .sidebar-icon {
            filter: brightness(0) invert(1) sepia(1) saturate(5) hue-rotate(320deg);
        }
</style>

@code {
    private bool isSidebarOpen = true;
    private bool hideSidebar = false;

    private void Logout()
    {
        NavigationManager.NavigateTo("/login");
    }

    private void ToggleSidebar() => isSidebarOpen = !isSidebarOpen;
    private void CloseSidebar() => isSidebarOpen = false;

    protected override void OnParametersSet()
    {
        var uri = NavigationManager.Uri.ToLower();
        // Hide sidebar only on login or register page
        hideSidebar = uri.Contains("/login") || uri.Contains("/register");
    }
}