@page "/dashboard"
@layout MainLayout
@inject NavigationManager NavigationManager

<div class="container-fluid px-0">
    <div class="dashboard-page">
        <!-- Header with Notification Bell -->
        <div class="dashboard-header">
            <div class="header-content">
                <div class="header-text">
                    <h1>Welcome to the Dashboard!</h1>
                    <p>Here you can see dashboard content.</p>
                </div>
                <div class="notification-wrapper">
                    <div class="notification-bell" @onclick="ToggleNotifications">
                        🔔
                        @if (unreadNotificationCount > 0)
                        {
                            <span class="notification-badge">@unreadNotificationCount</span>
                        }
                    </div>

                    <!-- Notifications Dropdown -->
                    @if (showNotifications)
                    {
                        <div class="notifications-dropdown">
                            <div class="notifications-header">
                                <h3>Notifications</h3>
                                <span class="notification-count">@unreadNotificationCount new</span>
                            </div>
                            <div class="notifications-list">
                                @foreach (var notification in notifications)
                                {
                                    <div class="notification-item @notification.Type">
                                        <span class="notification-icon">@notification.Icon</span>
                                        <div class="notification-content">
                                            <strong>@notification.Title</strong>
                                            <p>@notification.Message</p>
                                            <span class="notification-time">@notification.Time</span>
                                        </div>
                                    </div>
                                }
                            </div>
                            <div class="notifications-footer">
                                <button class="view-all-btn" @onclick="ViewAllNotifications">View All Notifications</button>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Alert Panel for Important Notifications -->
        @if (importantNotifications.Any() && showAlertPanel)
        {
            <div class="alert-panel">
                <div class="alert-header">
                    <h3>📢 Important Alerts</h3>
                    <button class="close-alerts" @onclick="DismissAlerts">×</button>
                </div>
                <div class="alert-list">
                    @foreach (var alert in importantNotifications)
                    {
                        <div class="alert-item @alert.Type">
                            <span class="alert-icon">@alert.Icon</span>
                            <div class="alert-content">
                                <strong>@alert.Title</strong>
                                <p>@alert.Message</p>
                            </div>
                        </div>
                    }
                </div>
            </div>
        }

        <!-- Responsive Statistics Grid using Bootstrap -->
        <div class="row g-3 mb-4">
            <div class="col-xxl-3 col-xl-3 col-lg-6 col-md-6 col-sm-6 col-12">
                <div class="stat-card">
                    <h3>TOTAL MEMBERS</h3>
                    <p class="stat-number">150</p>
                    @if (newMembersCount > 0)
                    {
                        <span class="stat-alert positive">+@newMembersCount new</span>
                    }
                </div>
            </div>
            <div class="col-xxl-3 col-xl-3 col-lg-6 col-md-6 col-sm-6 col-12">
                <div class="stat-card">
                    <h3>ACTIVE TRAINERS</h3>
                    <p class="stat-number">12</p>
                    @if (awayTrainersCount > 0)
                    {
                        <span class="stat-alert warning">-@awayTrainersCount away</span>
                    }
                </div>
            </div>
            <div class="col-xxl-3 col-xl-3 col-lg-6 col-md-6 col-sm-6 col-12">
                <div class="stat-card">
                    <h3>MONTHLY REVENUE</h3>
                    <p class="stat-number">5,200</p>
                    <span class="stat-alert positive">↑ 12%</span>
                </div>
            </div>
            <div class="col-xxl-3 col-xl-3 col-lg-6 col-md-6 col-sm-6 col-12">
                <div class="stat-card">
                    <h3>ATTENDANCE TODAY</h3>
                    <p class="stat-number">45</p>
                    <span class="stat-alert info">on track</span>
                </div>
            </div>
        </div>

        <div class="recent-activity">
            <h2>Recent Activity</h2>
            <div class="activity-list">
                <div class="activity-item">
                    <span class="activity-badge">[TODAY]</span>
                    <span class="activity-text">John Doe checked in</span>
                </div>
                <div class="activity-item">
                    <span class="activity-badge">[TODAY]</span>
                    <span class="activity-text">Jane Smith renewed membership</span>
                </div>
                <div class="activity-item">
                    <span class="activity-badge">[TODAY]</span>
                    <span class="activity-text">New member registration: Mike Johnson</span>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .container-fluid {
        width: 100%;
        margin: 0;
        padding: 0;
    }

    .dashboard-page {
        max-width: 100%;
        padding: 20px;
        margin: 0 auto;
        position: relative;
    }

    /* Header with Notifications */
    .dashboard-header {
        margin-bottom: 20px;
    }

    .header-content {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 20px;
    }

    .header-text {
        flex: 1;
    }

    /* Notification Bell */
    .notification-wrapper {
        position: relative;
    }

    .notification-bell {
        position: relative;
        background: white;
        border: 1px solid #e0e0e0;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

        .notification-bell:hover {
            background: #f8f9fa;
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

    .notification-badge {
        position: absolute;
        top: -5px;
        right: -5px;
        background: #e74c3c;
        color: white;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        font-size: 12px;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
        animation: pulse 2s infinite;
    }

    @@keyframes pulse {
        0% {
            transform: scale(1);
        }

        50% {
            transform: scale(1.1);
        }

        100% {
            transform: scale(1);
        }
    }

    /* Notifications Dropdown */
    .notifications-dropdown {
        position: absolute;
        top: 100%;
        right: 0;
        width: 350px;
        background: white;
        border: 1px solid #e0e0e0;
        border-radius: 10px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        z-index: 1000;
        margin-top: 10px;
    }

    .notifications-header {
        padding: 15px 20px;
        border-bottom: 1px solid #f0f0f0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

        .notifications-header h3 {
            margin: 0;
            color: #234060;
            font-size: 1.1rem;
        }

    .notification-count {
        background: #3868a7;
        color: white;
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 0.8rem;
        font-weight: 600;
    }

    .notifications-list {
        max-height: 300px;
        overflow-y: auto;
    }

    .notification-item {
        display: flex;
        padding: 12px 15px;
        border-bottom: 1px solid #f8f9fa;
        transition: background-color 0.2s ease;
        gap: 10px;
    }

        .notification-item:hover {
            background: #f8f9fa;
        }

        .notification-item.urgent {
            border-left: 3px solid #e74c3c;
        }

        .notification-item.warning {
            border-left: 3px solid #f39c12;
        }

        .notification-item.info {
            border-left: 3px solid #3498db;
        }

        .notification-item.success {
            border-left: 3px solid #27ae60;
        }

    .notification-icon {
        font-size: 16px;
        margin-top: 2px;
    }

    .notification-content {
        flex: 1;
    }

        .notification-content strong {
            display: block;
            color: #234060;
            font-size: 0.9rem;
            margin-bottom: 2px;
        }

        .notification-content p {
            margin: 0;
            color: #666;
            font-size: 0.85rem;
            line-height: 1.3;
        }

    .notification-time {
        font-size: 0.75rem;
        color: #999;
        margin-top: 4px;
        display: block;
    }

    .notifications-footer {
        padding: 12px 20px;
        border-top: 1px solid #f0f0f0;
        text-align: center;
    }

    .view-all-btn {
        background: none;
        border: none;
        color: #3868a7;
        font-weight: 600;
        cursor: pointer;
        font-size: 0.9rem;
    }

        .view-all-btn:hover {
            text-decoration: underline;
        }

    /* Alert Panel */
    .alert-panel {
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        margin-bottom: 25px;
        border-left: 4px solid #f39c12;
    }

    .alert-header {
        padding: 15px 20px;
        border-bottom: 1px solid #f0f0f0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

        .alert-header h3 {
            margin: 0;
            color: #234060;
            font-size: 1.1rem;
        }

    .close-alerts {
        background: none;
        border: none;
        font-size: 20px;
        color: #999;
        cursor: pointer;
        padding: 0;
        width: 24px;
        height: 24px;
    }

        .close-alerts:hover {
            color: #333;
        }

    .alert-list {
        padding: 10px 0;
    }

    .alert-item {
        display: flex;
        padding: 12px 20px;
        gap: 12px;
        border-bottom: 1px solid #f8f9fa;
    }

        .alert-item:last-child {
            border-bottom: none;
        }

        .alert-item.urgent {
            background: #ffeaa7;
        }

        .alert-item.warning {
            background: #fff3e0;
        }

    .alert-icon {
        font-size: 18px;
        margin-top: 2px;
    }

    .alert-content strong {
        display: block;
        color: #234060;
        font-size: 0.95rem;
        margin-bottom: 2px;
    }

    .alert-content p {
        margin: 0;
        color: #666;
        font-size: 0.85rem;
    }

    /* Statistics Grid */
    .row.g-3 {
        margin: 30px 0;
    }

    .stat-card {
        background: white;
        padding: 25px;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        text-align: center;
        border-left: 4px solid #3868a7;
        height: 100%;
        min-height: 120px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        position: relative;
    }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .stat-card h3 {
            margin: 0 0 10px 0;
            color: #666;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

    .stat-number {
        margin: 0;
        font-size: 2rem;
        font-weight: bold;
        color: #234060;
    }

    .stat-alert {
        position: absolute;
        top: 10px;
        right: 10px;
        font-size: 0.75rem;
        padding: 2px 6px;
        border-radius: 8px;
        font-weight: 600;
    }

        .stat-alert.positive {
            background: #d4edda;
            color: #155724;
        }

        .stat-alert.warning {
            background: #fff3cd;
            color: #856404;
        }

        .stat-alert.info {
            background: #d1ecf1;
            color: #0c5460;
        }

    /* Recent Activity */
    .recent-activity {
        background: white;
        padding: 25px;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        margin-top: 30px;
    }

        .recent-activity h2 {
            margin: 0 0 20px 0;
            color: #234060;
            border-bottom: 2px solid #f0f4f8;
            padding-bottom: 10px;
            font-size: 1.5rem;
            font-weight: 600;
        }

    .activity-list {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .activity-item {
        display: flex;
        align-items: center;
        padding: 12px 15px;
        background: #f8fafc;
        border-radius: 6px;
        border-left: 3px solid #3868a7;
        transition: background-color 0.2s ease;
    }

        .activity-item:hover {
            background: #e3f2fd;
        }

    .activity-badge {
        background: #234060;
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
        margin-right: 15px;
        font-family: monospace;
        font-weight: 500;
        min-width: 60px;
        text-align: center;
    }

    .activity-text {
        color: #333;
        font-weight: 500;
    }

    /* Responsive Design */
    @@media (max-width: 768px) {
        .header-content {
            flex-direction: column;
            gap: 15px;
        }

        .notifications-dropdown {
            width: 300px;
            right: -50px;
        }

        .notification-bell {
            align-self: flex-end;
        }
    }

    @@media (max-width: 480px) {
        .notifications-dropdown {
            width: 280px;
            right: -80px;
        }
    }
</style>

@code {
    private bool showNotifications = false;
    private int unreadNotificationCount = 3;
    private int newMembersCount = 2;
    private int awayTrainersCount = 1;
    private bool showAlertPanel = true;

    private List<DashboardNotification> notifications = new List<DashboardNotification>();
    private List<DashboardNotification> importantNotifications = new List<DashboardNotification>();

    protected override void OnInitialized()
    {
        LoadNotifications();
        LoadImportantNotifications();
    }

    private void LoadNotifications()
    {
        notifications = new List<DashboardNotification>
        {
            new DashboardNotification
            {
                Type = "urgent",
                Icon = "⚠️",
                Title = "Membership Expiring",
                Message = "John Doe's membership expires in 3 days",
                Time = "10:30 AM"
            },
            new DashboardNotification
            {
                Type = "warning",
                Icon = "🔧",
                Title = "Maintenance Required",
                Message = "Treadmill #3 needs service",
                Time = "09:15 AM"
            },
            new DashboardNotification
            {
                Type = "success",
                Icon = "💰",
                Title = "Payment Received",
                Message = "Jane Smith - Monthly subscription",
                Time = "Yesterday"
            },
            new DashboardNotification
            {
                Type = "info",
                Icon = "📋",
                Title = "New Application",
                Message = "2 new membership applications pending",
                Time = "Yesterday"
            }
        };
    }

    private void LoadImportantNotifications()
    {
        importantNotifications = new List<DashboardNotification>
        {
            new DashboardNotification
            {
                Type = "urgent",
                Icon = "⚠️",
                Title = "3 Memberships Expiring",
                Message = "Memberships expiring this week need attention"
            },
            new DashboardNotification
            {
                Type = "warning",
                Icon = "📊",
                Title = "Monthly Target",
                Message = "Revenue target at 85% for this month"
            }
        };
    }

    private void ToggleNotifications()
    {
        showNotifications = !showNotifications;
        if (showNotifications)
        {
            unreadNotificationCount = 0; // Mark as read when opened
        }
    }

    private void ViewAllNotifications()
    {
        // Navigate to the notifications page
        NavigationManager.NavigateTo("/notifications");
    }

    private void DismissAlerts()
    {
        showAlertPanel = false;
    }

    public class DashboardNotification
    {
        public string Type { get; set; } = ""; // urgent, warning, info, success
        public string Icon { get; set; } = "";
        public string Title { get; set; } = "";
        public string Message { get; set; } = "";
        public string Time { get; set; } = "";
    }
}